<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Comunidade - MASQUEKO</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#7c3aed">
    <link rel="apple-touch-icon" href="/assets/logo-masqueko.png">
    <link rel="icon" type="image/png" href="/assets/logo-masqueko.png">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/perfil-style.css">
	<link rel="stylesheet" href="/css/comunidades-style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
	<header class="navbar">
		<div class="navbar-content">
			<a href="/pages/home.html" class="logo">
				<img src="/assets/logo-masqueko.png" alt="Logo MASQUEKO" class="logo-img">
				<span>MASQUEKO</span>
			</a>
			<nav class="navbar-links">
                <a href="/pages/home.html" class="navbar-link">Início</a>
                <a href="/pages/comunidades.html" class="navbar-link active">Comunidades</a>
			    <a href="/pages/amigos.html" class="navbar-link">Amigos</a>
                <a href="/pages/saved.html" class="navbar-link"><i class="fa-solid fa-bookmark"></i> Salvos</a>
            </nav>
			
            <div class="user-menu">
                <a href="/pages/chat.html" class="notification-bell" id="notificationBell" title="Mensagens">
                    <i class="fa-solid fa-bell"></i>
                    <span id="notificationDot"></span>
                </a>
                <a href="/pages/perfil.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px;">
                    <span id="navUsername">Carregando...</span>
                    <img src="/assets/profile-pic.png" alt="Foto do Usuário" id="navUserPic">
                </a>
                <button id="logoutButton" title="Sair" aria-label="Sair"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </div>
	</header>

	<main class="main-content-wrapper">
		<div class="community-page-header">
			<img id="communityIcon" src="/assets/logo-masqueko.png" alt="Ícone da Comunidade" class="community-page-icon">
			<h1 id="communityName">Carregando...</h1>
			<p id="communityDescription"></p>
            <button id="joinCommunityBtn" class="join-btn" style="display: none;">Participar</button>
		</div>

        <div id="adminRequestsContainer" class="card" style="display: none; padding: 1.5rem; margin-bottom: 2rem; border-color: var(--primary-color);">
            <h3 style="margin-top: 0; color: var(--primary-dark);"><i class="fa-solid fa-users-gear"></i> Pedidos de Entrada Pendentes</h3>
            <div id="requestsList" style="display: flex; flex-direction: column; gap: 1rem;"></div>
        </div>

		<div class="community-content-grid">
			<div class="feed-column">
				<div class="create-post-box card" id="communityPostBox">
					<h3>Criar Postagem em <span id="postBoxCommunityName"></span></h3>
					<form id="createPostForm">
						<textarea id="postContentInput" name="conteudo" placeholder="Compartilhe suas ideias... (Markdown suportado)" required></textarea>
                        <input type="file" id="postMediaFile" accept="image/*,video/*" class="input-file-hidden">
                        <label for="postMediaFile" class="input-file-label" style="margin-top: 1rem;"><i class="fa-solid fa-cloud-arrow-up"></i> <span>Escolher Arquivo</span></label>
                        <input type="url" id="postImageUrlInput" class="url-input" placeholder="Ou cole um link de imagem/vídeo aqui..." style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; margin-top: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm);">
						<button type="submit" style="margin-top: 1rem;">Publicar</button>
					</form>
				</div>
				<hr class="section-divider" id="feedDivider">
                <div id="feedContainer"></div>
                <div id="accessDeniedMessage" class="card" style="display: none; padding: 3rem; text-align: center;">
                    <i class="fa-solid fa-lock" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
                    <h2>Comunidade Privada</h2>
                    <p>Você precisa ser membro aprovado para ver as postagens desta comunidade.</p>
                </div>
			</div>

            <aside class="side-column">
				<div class="community-info-card card">
					<h3>Sobre a Comunidade</h3>
					<p id="asideCommunityDescription"></p>
					<hr>
					<div class="community-stats"></div>
				</div>
                <div class="card trending-card">
                    <h3><i class="fa-solid fa-fire"></i> Em Alta</h3>
                    <ul class="trending-list" id="trendingListContainer">
                        <li>Carregando...</li>
                    </ul>
                </div>
            </aside>
        </div>
	</main>

    <div id="editPostModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title-post">
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="modal-title-post">Editar Postagem</h2>
                <button id="closeEditPostModalBtn" class="close-btn" aria-label="Fechar modal">&times;</button>
            </header>
            <form id="editPostForm">
                <input type="hidden" id="editPostIdInput">
                <div class="form-group">
                    <label for="editPostContentInput">Conteúdo:</label>
                    <textarea id="editPostContentInput" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editPostImageUrlInput">URL da Mídia:</label>
                    <input type="url" id="editPostImageUrlInput">
                </div>
                <button type="submit" class="submit-btn">Salvar Alterações</button>
            </form>
        </div>
    </div>

	<div id="notification"></div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="/js/api.js"></script>
	<script src="/js/community-script.js"></script>
</body>
</html>